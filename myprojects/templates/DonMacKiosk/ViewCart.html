{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Cart</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-[#f1f1f1] text-gray-800 font-sans">

  <header class="sticky top-0 z-50 w-full h-44 md:h-48 bg-black text-white overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-r from-[#0b0b0b] via-black to-[#0b0b0b]"></div>
    <div class="absolute inset-0 bg-gradient-to-b from-white/10 via-transparent to-transparent"></div>

    <div class="relative mx-auto max-w-7xl h-full flex items-center justify-between px-10">
      <div class="shrink-0">
        <img src="{% static 'myprojects/images/logodonmachos.png' %}" alt="Don Machos Logo"
          class="w-32 h-32 md:w-36 md:h-36 rounded-full" />
      </div>

      <div class="flex-1 text-center px-8">
        <h1 class="text-4xl md:text-5xl font-bold leading-none tracking-tight">
          Your Cup of Happiness
        </h1>
        <p class="mt-2 text-[10px] md:text-xs text-gray-300 tracking-[0.22em] uppercase">
          THE PERFECT CUP, THE PERFECT VIBE. COME EXPERIENCE THE DON MACHOS COMMUNITY.
        </p>
      </div>

      <div class="shrink-0 self-end -mb-10 md:-mb-12">
        <img src="{% static 'myprojects/images/Cupwithhand.png' %}" alt="Don Machos Cup"
          class="w-40 md:w-52 object-contain" />
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-5xl px-6 py-8">
    <div class="bg-white rounded-3xl shadow-lg overflow-hidden">

      <div class="flex items-center justify-between px-8 py-6 border-b">
        <h1 class="text-xl font-extrabold tracking-wide">YOUR ORDER</h1>

        <div class="flex items-center gap-3">
          <button type="button" onclick="window.location.href='{% url 'myprojects:menu' %}'"
            class="h-10 px-4 rounded-xl bg-gray-100 font-bold hover:bg-gray-200">
            Back
          </button>

          <button type="button" onclick="clearCartPage()"
            class="h-10 px-4 rounded-xl bg-black text-white font-bold
                   hover:bg-white hover:text-black hover:border hover:border-black transition">
            Clear
          </button>
        </div>
      </div>

      <!-- ✅ SERVER-RENDERED ITEMS (shows even if JS fails) -->
      <div class="px-8 py-6">
        <div id="cartItems" class="rounded-2xl border border-gray-100 overflow-hidden bg-white">

          {% if cart_items %}
            {% for item in cart_items %}
              <div class="flex items-center justify-between px-6 py-5 bg-white border-b">
                <div class="flex items-center gap-5">
                  <div class="w-20 h-20 rounded-2xl bg-gray-50 flex items-center justify-center overflow-hidden">
                    <img src="{{ item.imgSrc }}" class="w-16 h-16 object-contain" alt="{{ item.name }}">
                  </div>

                  <div class="leading-tight">
                    <div class="text-base font-extrabold uppercase">{{ item.name }}</div>

                    <div class="mt-1 text-xs text-gray-400">
                      {% if item.size == "S" %}Small{% elif item.size == "M" %}Medium{% else %}Large{% endif %}
                      |
                      {% if item.mood == "hot" %}Hot{% else %}Iced{% endif %}
                      |
                      {{ item.sugar }}
                    </div>

                    <div class="mt-2 text-sm font-bold">x{{ item.qty }}</div>
                  </div>
                </div>

                <div class="flex items-center gap-4">
                  <div class="text-sm font-extrabold text-gray-800 whitespace-nowrap">
                    ₱{{ item.price|floatformat:2 }}
                  </div>

                  <button type="button"
                    onclick="editCartItem('{{ item.id }}')"
                    class="h-10 px-4 rounded-xl bg-gray-100 font-bold hover:bg-gray-200">
                    Edit
                  </button>

                  <button type="button"
                    onclick="removeCartItem('{{ item.id }}')"
                    class="h-10 px-4 rounded-xl bg-black text-white font-bold
                           hover:bg-white hover:text-black hover:border hover:border-black transition">
                    Delete
                  </button>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="px-4 py-10 text-center text-sm text-gray-400">
              No items yet
            </div>
          {% endif %}

        </div>
      </div>

      <div class="px-8 py-6 border-t flex items-center justify-between">
        <div class="text-2xl font-extrabold">
          Total: <span id="cartTotalText">₱{{ cart_total|floatformat:2 }}</span>
        </div>

        <button id="cartCheckoutBtn" data-url="{% url 'myprojects:payment_option' %}"
          onclick="window.location.href=this.dataset.url"
          class="h-12 px-8 rounded-2xl bg-black text-white font-semibold shadow
                 transition-all duration-200 hover:bg-white hover:text-black hover:border hover:border-black">
          PROCEED TO CHECKOUT
        </button>
      </div>

    </div>
  </main>

  <!-- keep API wiring for delete/clear/edit JS -->
  <script>
    window.CART_API = {
      get: "{% url 'myprojects:cart_get' %}",
      add: "{% url 'myprojects:cart_add_or_edit' %}",
      remove: "{% url 'myprojects:cart_remove' %}",
      clear: "{% url 'myprojects:cart_clear' %}",
    };
  </script>

  <script src="{% static 'myprojects/JS/Cartpage.js' %}"></script>
</body>
</html>
